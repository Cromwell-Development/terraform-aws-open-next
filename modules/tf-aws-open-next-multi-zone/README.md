# Open Next Terraform - tf-aws-open-next-multi-zone

This module allows you to deploy multiple next.js websites using a [multi zone](https://nextjs.org/docs/pages/building-your-application/deploying/multi-zones) architecture. This uses [Open Next](https://github.com/serverless-stack/open-next) lambda, S3 and CloudFront.

This module supports three deployment options:

Independent Zones

![Multi Zone - Independent Zones](https://raw.githubusercontent.com/RJPearson94/terraform-aws-open-next/v2.0.2/docs/diagrams/Multi%20Zone%20-%20Independent%20Zones.png)

_Note:_ If you use tools like Terragrunt or CDKTF, you can use the Single Zone module to deploy each zone into its own terraform state

Shared Distribution

![Multi Zone - Shared Distribution](https://raw.githubusercontent.com/RJPearson94/terraform-aws-open-next/v2.0.2/docs/diagrams/Multi%20Zone%20-%20Shared%20Distribution.png)

Shared Distribution and Bucket

![Multi Zone - Shared Distribution](https://raw.githubusercontent.com/RJPearson94/terraform-aws-open-next/v2.0.2/docs/diagrams/Multi%20Zone%20-%20Shared%20Distribution%20and%20Bucket.png)

The following are optional:

- Route 53 (A and AAAA records)
- WAF
- Staging Distribution
- Warmer function
- Image Optimization function
- Tag to Path Mapping DB

See the module documentation section below for more info.

_Note:_ This module uses multiple bash scripts to delete data, upload data and mutate resources outside of Terraform. This prevents Terraform from removing resources when they have changed and allows the staging distribution functionality to work correctly.

You must have bash and the AWS CLI available, the CLI must be configured to use the same credentials or environment variables as the default AWS provider for this functionality to work correctly.

If you need to destroy the Terraform resources, it is recommended that you enable `force_destroy` on the website bucket to delete the assets in the bucket when running a Terraform destory.

## Continuous deployment

This module supports CloudFront continuous deployment. See the [continuous deployment docs](https://github.com/RJPearson94/terraform-aws-open-next/blob/v2.0.2/docs/continuous-deployments.md) for instructions on how to leverage this capability.

## Backend Server Deployment Options

See the [backend server deployment docs](https://github.com/RJPearson94/terraform-aws-open-next/blob/v2.0.2/docs/backend-server-deployments.md) for instructions to see the options.

## Module documentation

Below is the documentation for the Terraform module, outlining the providers, modules and resources required to deploy the website. The documentation includes the inputs that can be supplied (including any defaults) and what is outputted from the module.

By default, the module will zip all the necessary open-next artefacts as part of a Terraform deployment. To facilitate this, the .open-next folders need to be stored locally.

You can also choose to upload the artefacts to S3 and pass the reference in.

_Note:_ the logic to automatically inject environment variables for lambda@edge functions will not run if you choose this option

Alternatively you can create the zip using your own tooling and supply the path to the zip file and the hash (SHA256 hash of the file encoded using Base64).

You must configure the AWS providers five times because some organizations use different accounts or roles for IAM, DNS, etc. The module has been designed to cater for these requirements. The server function is a separate provider to allow your backend resources to be deployed to a region, i.e. eu-west-1, and deploy the server function to another region, i.e. us-east-1, for lambda@edge. The `global` provider region should be set to us-east-1 to allow the auth-function, WAF, etc. to be configured correctly.

Below is an example setup.

```tf
provider "aws" {}

provider "aws" {
  alias = "server_function"
}

provider "aws" {
  alias = "iam"
}

provider "aws" {
  alias = "dns"
}

provider "aws" {
  alias  = "global"
  region = "us-east-1"
}
```

### Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.4.0 |
| <a name="requirement_archive"></a> [archive](#requirement\_archive) | >= 2.3.0 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | >= 5.26.0 |
| <a name="requirement_local"></a> [local](#requirement\_local) | >= 2.4.0 |

### Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | 5.29.0 |

### Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_public_resources"></a> [public\_resources](#module\_public\_resources) | ../tf-aws-open-next-public-resources | n/a |
| <a name="module_website_zone"></a> [website\_zone](#module\_website\_zone) | ../tf-aws-open-next-zone | n/a |

### Resources

| Name | Type |
|------|------|
| [aws_s3_bucket.shared_bucket](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket) | resource |
| [aws_s3_bucket_policy.shared_bucket_policy](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_policy) | resource |
| [aws_s3_bucket_policy.shared_distribution_bucket_policy](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_policy) | resource |
| [aws_region.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/region) | data source |

### Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_aliases"></a> [aliases](#input\_aliases) | The production and staging aliases to use. This can be overridden for each zone | <pre>object({<br>    production = string<br>    staging    = string<br>  })</pre> | `null` | no |
| <a name="input_behaviours"></a> [behaviours](#input\_behaviours) | Override the default behaviour config. When the deployment is set to 'INDEPENDENT\_ZONES' this can be overridden for each zone. If deployment is 'SHARED\_DISTRIBUTION' or 'SHARED\_DISTRIBUTION\_AND\_BUCKET' this configuration is used | <pre>object({<br>    custom_error_responses = optional(object({<br>      path_overrides = optional(map(object({<br>        allowed_methods          = optional(list(string))<br>        cached_methods           = optional(list(string))<br>        cache_policy_id          = optional(string)<br>        origin_request_policy_id = optional(string)<br>        compress                 = optional(bool)<br>        viewer_protocol_policy   = optional(string)<br>        viewer_request = optional(object({<br>          type         = string<br>          arn          = string<br>          include_body = optional(bool)<br>        }))<br>        viewer_response = optional(object({<br>          type = string<br>          arn  = string<br>        }))<br>        origin_request = optional(object({<br>          arn          = string<br>          include_body = bool<br>        }))<br>        origin_response = optional(object({<br>          arn = string<br>        }))<br>      })))<br>      allowed_methods          = optional(list(string))<br>      cached_methods           = optional(list(string))<br>      cache_policy_id          = optional(string)<br>      origin_request_policy_id = optional(string)<br>      compress                 = optional(bool)<br>      viewer_protocol_policy   = optional(string)<br>      viewer_request = optional(object({<br>        type         = string<br>        arn          = string<br>        include_body = optional(bool)<br>      }))<br>      viewer_response = optional(object({<br>        type = string<br>        arn  = string<br>      }))<br>      origin_request = optional(object({<br>        type         = string<br>        arn          = string<br>        include_body = optional(bool)<br>      }))<br>      origin_response = optional(object({<br>        type = string<br>        arn  = string<br>      }))<br>    }))<br>    static_assets = optional(object({<br>      paths            = optional(list(string))<br>      additional_paths = optional(list(string))<br>      path_overrides = optional(map(object({<br>        allowed_methods          = optional(list(string))<br>        cached_methods           = optional(list(string))<br>        cache_policy_id          = optional(string)<br>        origin_request_policy_id = optional(string)<br>        compress                 = optional(bool)<br>        viewer_protocol_policy   = optional(string)<br>        viewer_request = optional(object({<br>          type         = string<br>          arn          = string<br>          include_body = optional(bool)<br>        }))<br>        viewer_response = optional(object({<br>          type = string<br>          arn  = string<br>        }))<br>        origin_request = optional(object({<br>          arn          = string<br>          include_body = bool<br>        }))<br>        origin_response = optional(object({<br>          arn = string<br>        }))<br>      })))<br>      allowed_methods          = optional(list(string))<br>      cached_methods           = optional(list(string))<br>      cache_policy_id          = optional(string)<br>      origin_request_policy_id = optional(string)<br>      compress                 = optional(bool)<br>      viewer_protocol_policy   = optional(string)<br>      viewer_request = optional(object({<br>        type         = string<br>        arn          = string<br>        include_body = optional(bool)<br>      }))<br>      viewer_response = optional(object({<br>        type = string<br>        arn  = string<br>      }))<br>      origin_request = optional(object({<br>        type         = string<br>        arn          = string<br>        include_body = optional(bool)<br>      }))<br>      origin_response = optional(object({<br>        type = string<br>        arn  = string<br>      }))<br>    }))<br>    server = optional(object({<br>      paths = optional(list(string))<br>      path_overrides = map(object({<br>        allowed_methods          = optional(list(string))<br>        cached_methods           = optional(list(string))<br>        cache_policy_id          = optional(string)<br>        origin_request_policy_id = optional(string)<br>        compress                 = optional(bool)<br>        viewer_protocol_policy   = optional(string)<br>        viewer_request = optional(object({<br>          type         = string<br>          arn          = string<br>          include_body = optional(bool)<br>        }))<br>        viewer_response = optional(object({<br>          type = string<br>          arn  = string<br>        }))<br>        origin_request = optional(object({<br>          arn          = string<br>          include_body = bool<br>        }))<br>        origin_response = optional(object({<br>          arn = string<br>        }))<br>      }))<br>      allowed_methods          = optional(list(string))<br>      cached_methods           = optional(list(string))<br>      cache_policy_id          = optional(string)<br>      origin_request_policy_id = optional(string)<br>      compress                 = optional(bool)<br>      viewer_protocol_policy   = optional(string)<br>      viewer_request = optional(object({<br>        type         = string<br>        arn          = string<br>        include_body = optional(bool)<br>      }))<br>      viewer_response = optional(object({<br>        type = string<br>        arn  = string<br>      }))<br>      origin_request = optional(object({<br>        type         = string<br>        arn          = string<br>        include_body = optional(bool)<br>      }))<br>      origin_response = optional(object({<br>        type = string<br>        arn  = string<br>      }))<br>    }))<br>    image_optimisation = optional(object({<br>      paths = optional(list(string))<br>      path_overrides = map(object({<br>        allowed_methods          = optional(list(string))<br>        cached_methods           = optional(list(string))<br>        cache_policy_id          = optional(string)<br>        origin_request_policy_id = optional(string)<br>        compress                 = optional(bool)<br>        viewer_protocol_policy   = optional(string)<br>        viewer_request = optional(object({<br>          type         = string<br>          arn          = string<br>          include_body = optional(bool)<br>        }))<br>        viewer_response = optional(object({<br>          type = string<br>          arn  = string<br>        }))<br>        origin_request = optional(object({<br>          arn          = string<br>          include_body = bool<br>        }))<br>        origin_response = optional(object({<br>          arn = string<br>        }))<br>      }))<br>      allowed_methods          = optional(list(string))<br>      cached_methods           = optional(list(string))<br>      cache_policy_id          = optional(string)<br>      origin_request_policy_id = optional(string)<br>      compress                 = optional(bool)<br>      viewer_protocol_policy   = optional(string)<br>      viewer_request = optional(object({<br>        type         = string<br>        arn          = string<br>        include_body = optional(bool)<br>      }))<br>      viewer_response = optional(object({<br>        type = string<br>        arn  = string<br>      }))<br>      origin_request = optional(object({<br>        type         = string<br>        arn          = string<br>        include_body = optional(bool)<br>      }))<br>      origin_response = optional(object({<br>        type = string<br>        arn  = string<br>      }))<br>    }))<br>  })</pre> | `{}` | no |
| <a name="input_cache_control_immutable_assets_regex"></a> [cache\_control\_immutable\_assets\_regex](#input\_cache\_control\_immutable\_assets\_regex) | Regex to set public,max-age=31536000,immutable on immutable resources. This can be overridden for each zone | `string` | `"^.*(\\.next)$"` | no |
| <a name="input_cloudwatch_log"></a> [cloudwatch\_log](#input\_cloudwatch\_log) | The default cloudwatch log group. This can be overridden for each zone and each function | <pre>object({<br>    retention_in_days = number<br>  })</pre> | <pre>{<br>  "retention_in_days": 7<br>}</pre> | no |
| <a name="input_content_types"></a> [content\_types](#input\_content\_types) | The MIME type mapping and default for artefacts generated by Open Next. This can be overridden for each zone | <pre>object({<br>    mapping = optional(map(string), {<br>      "svg"  = "image/svg+xml",<br>      "js"   = "application/javascript",<br>      "css"  = "text/css",<br>      "html" = "text/html"<br>    })<br>    default = optional(string, "binary/octet-stream")<br>  })</pre> | `{}` | no |
| <a name="input_continuous_deployment"></a> [continuous\_deployment](#input\_continuous\_deployment) | Configuration for continuous deployment config for CloudFront. When the deployment is set to 'INDEPENDENT\_ZONES' this can be overridden for each zone. If continuous deployment is enabled, updates to the origins, ordered\_cache\_behaviors and default\_cache\_behaviors are ignored | <pre>object({<br>    use        = optional(bool, false)<br>    deployment = optional(string, "NONE")<br>    traffic_config = optional(object({<br>      header = optional(object({<br>        name  = string<br>        value = string<br>      }))<br>      weight = optional(object({<br>        percentage = number<br>        session_stickiness = optional(object({<br>          idle_ttl    = number<br>          maximum_ttl = number<br>        }))<br>      }))<br>    }))<br>  })</pre> | `{}` | no |
| <a name="input_custom_error_responses"></a> [custom\_error\_responses](#input\_custom\_error\_responses) | Allow custom error responses to be set on the distributions. When the deployment is set to 'INDEPENDENT\_ZONES' this can be overridden for each zone. If deployment is 'SHARED\_DISTRIBUTION' or 'SHARED\_DISTRIBUTION\_AND\_BUCKET' this configuration is used. If the deployment is 'SHARED\_DISTRIBUTION', the files are saved into the root zone bucket. If the deployment is 'SHARED\_DISTRIBUTION\_AND\_BUCKET' the files are saved in the shared bucket | <pre>list(object({<br>    error_code            = string<br>    error_caching_min_ttl = optional(number)<br>    response_code         = optional(string)<br>    response_page = optional(object({<br>      source      = string<br>      path_prefix = string<br>    }))<br>  }))</pre> | `[]` | no |
| <a name="input_deployment"></a> [deployment](#input\_deployment) | The deployment model for the multi zone website | `string` | n/a | yes |
| <a name="input_distribution"></a> [distribution](#input\_distribution) | Configuration for the CloudFront distribution. When the deployment is set to 'INDEPENDENT\_ZONES' this can be overridden for each zone. If deployment is 'SHARED\_DISTRIBUTION' or 'SHARED\_DISTRIBUTION\_AND\_BUCKET' this configuration is used | <pre>object({<br>    deployment   = optional(string, "CREATE")<br>    enabled      = optional(bool, true)<br>    ipv6_enabled = optional(bool, true)<br>    http_version = optional(string, "http2")<br>    price_class  = optional(string, "PriceClass_100")<br>    geo_restrictions = optional(object({<br>      type      = optional(string, "none"),<br>      locations = optional(list(string), [])<br>    }), {})<br>    x_forwarded_host_function = optional(object({<br>      runtime = optional(string)<br>      code    = optional(string)<br>    }), {})<br>    auth_function = optional(object({<br>      deployment    = optional(string, "NONE")<br>      qualified_arn = optional(string)<br>      function_code = optional(object({<br>        handler = optional(string, "index.handler")<br>        zip = optional(object({<br>          path = string<br>          hash = string<br>        }))<br>        s3 = optional(object({<br>          bucket         = string<br>          key            = string<br>          object_version = optional(string)<br>        }))<br>      }))<br>      runtime     = optional(string, "nodejs20.x")<br>      timeout     = optional(number, 10)<br>      memory_size = optional(number, 256)<br>      additional_iam_policies = optional(list(object({<br>        name   = string,<br>        arn    = optional(string)<br>        policy = optional(string)<br>      })), [])<br>      iam = optional(object({<br>        path                 = optional(string)<br>        permissions_boundary = optional(string)<br>      }))<br>      cloudwatch_log = optional(object({<br>        retention_in_days = number<br>      }))<br>      timeouts = optional(object({<br>        create = optional(string)<br>        update = optional(string)<br>        delete = optional(string)<br>      }), {})<br>    }), {})<br>    cache_policy = optional(object({<br>      deployment            = optional(string, "CREATE")<br>      arn                   = optional(string)<br>      default_ttl           = optional(number, 0)<br>      max_ttl               = optional(number, 31536000)<br>      min_ttl               = optional(number, 0)<br>      cookie_behavior       = optional(string, "all")<br>      header_behavior       = optional(string, "whitelist")<br>      header_items          = optional(list(string), ["accept", "rsc", "next-router-prefetch", "next-router-state-tree", "next-url"])<br>      query_string_behavior = optional(string, "all")<br>    }), {})<br>  })</pre> | `{}` | no |
| <a name="input_domain_config"></a> [domain\_config](#input\_domain\_config) | Configuration for CloudFront distribution domain. When the deployment is set to 'INDEPENDENT\_ZONES' this can be overridden for each zone. If deployment is 'SHARED\_DISTRIBUTION' or 'SHARED\_DISTRIBUTION\_AND\_BUCKET' this configuration is used | <pre>object({<br>    evaluate_target_health = optional(bool, true)<br>    sub_domain             = optional(string)<br>    hosted_zones = list(object({<br>      name         = string<br>      id           = optional(string)<br>      private_zone = optional(bool, false)<br>    }))<br>    create_route53_entries = optional(bool, true)<br>    viewer_certificate = optional(object({<br>      acm_certificate_arn      = string<br>      ssl_support_method       = optional(string, "sni-only")<br>      minimum_protocol_version = optional(string, "TLSv1.2_2021")<br>    }))<br>  })</pre> | `null` | no |
| <a name="input_function_architecture"></a> [function\_architecture](#input\_function\_architecture) | The default instruction set architecture for the lambda functions. This can be overridden for each zone and each function | `string` | `"arm64"` | no |
| <a name="input_iam"></a> [iam](#input\_iam) | The default IAM configuration. This can be overridden for each zone and each function | <pre>object({<br>    path                 = optional(string, "/")<br>    permissions_boundary = optional(string)<br>  })</pre> | `{}` | no |
| <a name="input_image_optimisation_function"></a> [image\_optimisation\_function](#input\_image\_optimisation\_function) | Configuration for the image optimisation function. This can be overridden for each zone | <pre>object({<br>    create = optional(bool, true)<br>    function_code = optional(object({<br>      handler = optional(string, "index.handler")<br>      zip = optional(object({<br>        path = string<br>        hash = string<br>      }))<br>      s3 = optional(object({<br>        bucket         = string<br>        key            = string<br>        object_version = optional(string)<br>      }))<br>    }))<br>    runtime                          = optional(string, "nodejs20.x")<br>    backend_deployment_type          = optional(string, "REGIONAL_LAMBDA")<br>    timeout                          = optional(number, 25)<br>    memory_size                      = optional(number, 1536)<br>    additional_environment_variables = optional(map(string), {})<br>    function_architecture            = optional(string)<br>    additional_iam_policies = optional(list(object({<br>      name   = string,<br>      arn    = optional(string)<br>      policy = optional(string)<br>    })), [])<br>    vpc = optional(object({<br>      security_group_ids = list(string),<br>      subnet_ids         = list(string)<br>    }))<br>    iam = optional(object({<br>      path                 = optional(string)<br>      permissions_boundary = optional(string)<br>    }))<br>    cloudwatch_log = optional(object({<br>      retention_in_days = number<br>    }))<br>    timeouts = optional(object({<br>      create = optional(string)<br>      update = optional(string)<br>      delete = optional(string)<br>    }), {})<br>  })</pre> | `{}` | no |
| <a name="input_prefix"></a> [prefix](#input\_prefix) | A prefix which will be attached to the resource name to ensure resources are random | `string` | `null` | no |
| <a name="input_prefix_path_overrides"></a> [prefix\_path\_overrides](#input\_prefix\_path\_overrides) | Whether to add the path to the path overrides. This can be overridden for each zone | `bool` | `true` | no |
| <a name="input_revalidation_function"></a> [revalidation\_function](#input\_revalidation\_function) | Configuration for the revalidation function. This can be overridden for each zone | <pre>object({<br>    function_code = optional(object({<br>      handler = optional(string, "index.handler")<br>      zip = optional(object({<br>        path = string<br>        hash = string<br>      }))<br>      s3 = optional(object({<br>        bucket         = string<br>        key            = string<br>        object_version = optional(string)<br>      }))<br>    }))<br>    runtime                          = optional(string, "nodejs20.x")<br>    timeout                          = optional(number, 25)<br>    memory_size                      = optional(number, 1536)<br>    additional_environment_variables = optional(map(string), {})<br>    function_architecture            = optional(string)<br>    additional_iam_policies = optional(list(object({<br>      name   = string,<br>      arn    = optional(string)<br>      policy = optional(string)<br>    })), [])<br>    vpc = optional(object({<br>      security_group_ids = list(string),<br>      subnet_ids         = list(string)<br>    }))<br>    iam = optional(object({<br>      path                 = optional(string)<br>      permissions_boundary = optional(string)<br>    }))<br>    cloudwatch_log = optional(object({<br>      retention_in_days = number<br>    }))<br>    timeouts = optional(object({<br>      create = optional(string)<br>      update = optional(string)<br>      delete = optional(string)<br>    }), {})<br>  })</pre> | `{}` | no |
| <a name="input_s3_exclusion_regex"></a> [s3\_exclusion\_regex](#input\_s3\_exclusion\_regex) | A regex of files to exclude from the s3 copy. his can be overridden for each zone | `string` | `null` | no |
| <a name="input_server_function"></a> [server\_function](#input\_server\_function) | Configuration for the server function. This can be overridden for each zone | <pre>object({<br>    function_code = optional(object({<br>      handler = optional(string, "index.handler")<br>      zip = optional(object({<br>        path = string<br>        hash = string<br>      }))<br>      s3 = optional(object({<br>        bucket         = string<br>        key            = string<br>        object_version = optional(string)<br>      }))<br>    }))<br>    runtime                          = optional(string, "nodejs20.x")<br>    backend_deployment_type          = optional(string, "REGIONAL_LAMBDA")<br>    timeout                          = optional(number, 10)<br>    memory_size                      = optional(number, 1024)<br>    function_architecture            = optional(string)<br>    additional_environment_variables = optional(map(string), {})<br>    additional_iam_policies = optional(list(object({<br>      name   = string,<br>      arn    = optional(string)<br>      policy = optional(string)<br>    })), [])<br>    vpc = optional(object({<br>      security_group_ids = list(string),<br>      subnet_ids         = list(string)<br>    }))<br>    iam = optional(object({<br>      path                 = optional(string)<br>      permissions_boundary = optional(string)<br>    }))<br>    cloudwatch_log = optional(object({<br>      retention_in_days = number<br>    }))<br>    timeouts = optional(object({<br>      create = optional(string)<br>      update = optional(string)<br>      delete = optional(string)<br>    }), {})<br>  })</pre> | `{}` | no |
| <a name="input_suffix"></a> [suffix](#input\_suffix) | A suffix which will be attached to the resource name to ensure resources are random | `string` | `null` | no |
| <a name="input_tag_mapping_db"></a> [tag\_mapping\_db](#input\_tag\_mapping\_db) | Configuration for the ISR tag mapping database. This can be overridden for each zone | <pre>object({<br>    deployment     = optional(string, "CREATE")<br>    billing_mode   = optional(string, "PAY_PER_REQUEST")<br>    read_capacity  = optional(number)<br>    write_capacity = optional(number)<br>    revalidate_gsi = optional(object({<br>      read_capacity  = optional(number)<br>      write_capacity = optional(number)<br>    }), {})<br>  })</pre> | `{}` | no |
| <a name="input_vpc"></a> [vpc](#input\_vpc) | The default VPC configuration for the lambda resources. This can be overridden for each zone and each function | <pre>object({<br>    security_group_ids = list(string),<br>    subnet_ids         = list(string)<br>  })</pre> | `null` | no |
| <a name="input_waf"></a> [waf](#input\_waf) | Configuration for the CloudFront distribution WAF. For enforce basic auth, to protect the secret value, the encoded string has been marked as sensitive. I would make this configurable to allow it to be marked as sensitive or not however Terraform panics when you use the sensitive function as part of a ternary. If you need to see all rules, see this discussion https://discuss.hashicorp.com/t/how-to-show-sensitive-values/24076/4. When the deployment is set to 'INDEPENDENT\_ZONES' this can be overridden for each zone. If deployment is 'SHARED\_DISTRIBUTION' or 'SHARED\_DISTRIBUTION\_AND\_BUCKET' this configuration is used | <pre>object({<br>    deployment = optional(string, "NONE")<br>    web_acl_id = optional(string)<br>    aws_managed_rules = optional(list(object({<br>      priority              = optional(number)<br>      name                  = string<br>      aws_managed_rule_name = string<br>      })), [{<br>      name                  = "amazon-ip-reputation-list"<br>      aws_managed_rule_name = "AWSManagedRulesAmazonIpReputationList"<br>      }, {<br>      name                  = "common-rule-set"<br>      aws_managed_rule_name = "AWSManagedRulesCommonRuleSet"<br>      }, {<br>      name                  = "known-bad-inputs"<br>      aws_managed_rule_name = "AWSManagedRulesKnownBadInputsRuleSet"<br>    }])<br>    rate_limiting = optional(object({<br>      enabled = optional(bool, false)<br>      limits = optional(list(object({<br>        priority         = optional(number)<br>        rule_name_suffix = optional(string)<br>        limit            = optional(number, 1000)<br>        action           = optional(string, "BLOCK")<br>        geo_match_scope  = optional(list(string))<br>      })), [])<br>    }), {})<br>    sqli = optional(object({<br>      enabled  = optional(bool, false)<br>      priority = optional(number)<br>    }), {})<br>    account_takeover_protection = optional(object({<br>      enabled              = optional(bool, false)<br>      priority             = optional(number)<br>      login_path           = string<br>      enable_regex_in_path = optional(bool)<br>      request_inspection = optional(object({<br>        username_field_identifier = string<br>        password_field_identifier = string<br>        payload_type              = string<br>      }))<br>      response_inspection = optional(object({<br>        failure_codes = list(string)<br>        success_codes = list(string)<br>      }))<br>    }))<br>    account_creation_fraud_prevention = optional(object({<br>      enabled                = optional(bool, false)<br>      priority               = optional(number)<br>      creation_path          = string<br>      registration_page_path = string<br>      enable_regex_in_path   = optional(bool)<br>      request_inspection = optional(object({<br>        email_field_identifier    = string<br>        username_field_identifier = string<br>        password_field_identifier = string<br>        payload_type              = string<br>      }))<br>      response_inspection = optional(object({<br>        failure_codes = list(string)<br>        success_codes = list(string)<br>      }))<br>    }))<br>    enforce_basic_auth = optional(object({<br>      enabled       = optional(bool, false)<br>      priority      = optional(number)<br>      response_code = optional(number, 401)<br>      response_header = optional(object({<br>        name  = optional(string, "WWW-Authenticate")<br>        value = optional(string, "Basic realm=\"Requires basic auth\"")<br>      }), {})<br>      header_name = optional(string, "authorization")<br>      credentials = optional(object({<br>        username          = string<br>        password          = string<br>        mark_as_sensitive = optional(bool, true)<br>      }))<br>      ip_address_restrictions = optional(list(object({<br>        action = optional(string, "BYPASS")<br>        arn    = optional(string)<br>        name   = optional(string)<br>      })))<br>    }))<br>    additional_rules = optional(list(object({<br>      enabled  = optional(bool, false)<br>      priority = optional(number)<br>      name     = string<br>      action   = optional(string, "COUNT")<br>      block_action = optional(object({<br>        response_code = number<br>        response_header = optional(object({<br>          name  = string<br>          value = string<br>        }))<br>        custom_response_body_key = optional(string)<br>      }))<br>      ip_address_restrictions = list(object({<br>        action = optional(string, "BYPASS")<br>        arn    = optional(string)<br>        name   = optional(string)<br>      }))<br>    })))<br>    default_action = optional(object({<br>      action = optional(string, "ALLOW")<br>      block_action = optional(object({<br>        response_code = number<br>        response_header = optional(object({<br>          name  = string<br>          value = string<br>        }))<br>        custom_response_body_key = optional(string)<br>      }))<br>    }))<br>    ip_addresses = optional(map(object({<br>      description        = optional(string)<br>      ip_address_version = string<br>      addresses          = list(string)<br>    })))<br>    custom_response_bodies = optional(list(object({<br>      key          = string<br>      content      = string<br>      content_type = string<br>    })))<br>  })</pre> | `{}` | no |
| <a name="input_warmer_function"></a> [warmer\_function](#input\_warmer\_function) | Configuration for the warmer function. This can be overridden for each zone | <pre>object({<br>    enabled = optional(bool, false)<br>    warm_staging = optional(object({<br>      enabled     = optional(bool, false)<br>      concurrency = optional(number)<br>    }))<br>    function_code = optional(object({<br>      handler = optional(string, "index.handler")<br>      zip = optional(object({<br>        path = string<br>        hash = string<br>      }))<br>      s3 = optional(object({<br>        bucket         = string<br>        key            = string<br>        object_version = optional(string)<br>      }))<br>    }))<br>    runtime                          = optional(string, "nodejs20.x")<br>    concurrency                      = optional(number, 20)<br>    timeout                          = optional(number, 15 * 60) // 15 minutes<br>    memory_size                      = optional(number, 1024)<br>    function_architecture            = optional(string)<br>    schedule                         = optional(string, "rate(5 minutes)")<br>    additional_environment_variables = optional(map(string), {})<br>    additional_iam_policies = optional(list(object({<br>      name   = string,<br>      arn    = optional(string)<br>      policy = optional(string)<br>    })), [])<br>    vpc = optional(object({<br>      security_group_ids = list(string),<br>      subnet_ids         = list(string)<br>    }))<br>    iam = optional(object({<br>      path                 = optional(string)<br>      permissions_boundary = optional(string)<br>    }))<br>    cloudwatch_log = optional(object({<br>      retention_in_days = number<br>    }))<br>    timeouts = optional(object({<br>      create = optional(string)<br>      update = optional(string)<br>      delete = optional(string)<br>    }), {})<br>  })</pre> | `{}` | no |
| <a name="input_website_bucket"></a> [website\_bucket](#input\_website\_bucket) | Configuration for the website S3 bucket.  When the deployment is set to 'INDEPENDENT\_ZONES' or 'SHARED\_DISTRIBUTION' this can be overridden for each zone. If deployment is 'SHARED\_DISTRIBUTION\_AND\_BUCKET' this configuration is used | <pre>object({<br>    force_destroy = optional(bool, false)<br>    arn           = optional(string)<br>    region        = optional(string)<br>    name          = optional(string)<br>  })</pre> | `{}` | no |
| <a name="input_zones"></a> [zones](#input\_zones) | The website zones to create | <pre>list(object({<br>    root                  = bool<br>    name                  = string<br>    folder_path           = string<br>    path                  = optional(string)<br>    prefix_path_overrides = optional(bool, true)<br>    s3_exclusion_regex    = optional(string)<br>    function_architecture = optional(string)<br>    iam = optional(object({<br>      path                 = optional(string, "/")<br>      permissions_boundary = optional(string)<br>    }))<br>    cloudwatch_log = optional(object({<br>      retention_in_days = number<br>    }))<br>    vpc = optional(object({<br>      security_group_ids = list(string),<br>      subnet_ids         = list(string)<br>    }))<br>    aliases = optional(object({<br>      production = string<br>      staging    = string<br>    }))<br>    cache_control_immutable_assets_regex = optional(string)<br>    content_types = optional(object({<br>      mapping = optional(map(string), {<br>        "svg"  = "image/svg+xml",<br>        "js"   = "application/javascript",<br>        "css"  = "text/css",<br>        "html" = "text/html"<br>      })<br>      default = optional(string, "binary/octet-stream")<br>    }))<br>    warmer_function = optional(object({<br>      enabled = optional(bool, false)<br>      warm_staging = optional(object({<br>        enabled     = optional(bool, false)<br>        concurrency = optional(number)<br>      }))<br>      function_code = optional(object({<br>        handler = optional(string, "index.handler")<br>        zip = optional(object({<br>          path = string<br>          hash = string<br>        }))<br>        s3 = optional(object({<br>          bucket         = string<br>          key            = string<br>          object_version = optional(string)<br>        }))<br>      }))<br>      runtime                          = optional(string, "nodejs20.x")<br>      concurrency                      = optional(number, 20)<br>      timeout                          = optional(number, 15 * 60) // 15 minutes<br>      memory_size                      = optional(number, 1024)<br>      function_architecture            = optional(string)<br>      schedule                         = optional(string, "rate(5 minutes)")<br>      additional_environment_variables = optional(map(string), {})<br>      additional_iam_policies = optional(list(object({<br>        name   = string,<br>        arn    = optional(string)<br>        policy = optional(string)<br>      })), [])<br>      vpc = optional(object({<br>        security_group_ids = list(string),<br>        subnet_ids         = list(string)<br>      }))<br>      iam = optional(object({<br>        path                 = optional(string)<br>        permissions_boundary = optional(string)<br>      }))<br>      cloudwatch_log = optional(object({<br>        retention_in_days = number<br>      }))<br>      timeouts = optional(object({<br>        create = optional(string)<br>        update = optional(string)<br>        delete = optional(string)<br>      }), {})<br>    }))<br>    server_function = optional(object({<br>      function_code = optional(object({<br>        handler = optional(string, "index.handler")<br>        zip = optional(object({<br>          path = string<br>          hash = string<br>        }))<br>        s3 = optional(object({<br>          bucket         = string<br>          key            = string<br>          object_version = optional(string)<br>        }))<br>      }))<br>      runtime                          = optional(string, "nodejs20.x")<br>      backend_deployment_type          = optional(string, "REGIONAL_LAMBDA")<br>      timeout                          = optional(number, 10)<br>      memory_size                      = optional(number, 1024)<br>      function_architecture            = optional(string)<br>      additional_environment_variables = optional(map(string), {})<br>      additional_iam_policies = optional(list(object({<br>        name   = string,<br>        arn    = optional(string)<br>        policy = optional(string)<br>      })), [])<br>      vpc = optional(object({<br>        security_group_ids = list(string),<br>        subnet_ids         = list(string)<br>      }))<br>      iam = optional(object({<br>        path                 = optional(string)<br>        permissions_boundary = optional(string)<br>      }))<br>      cloudwatch_log = optional(object({<br>        retention_in_days = number<br>      }))<br>      timeouts = optional(object({<br>        create = optional(string)<br>        update = optional(string)<br>        delete = optional(string)<br>      }), {})<br>    }))<br>    image_optimisation_function = optional(object({<br>      create = optional(bool, true)<br>      function_code = optional(object({<br>        handler = optional(string, "index.handler")<br>        zip = optional(object({<br>          path = string<br>          hash = string<br>        }))<br>        s3 = optional(object({<br>          bucket         = string<br>          key            = string<br>          object_version = optional(string)<br>        }))<br>      }))<br>      runtime                          = optional(string, "nodejs20.x")<br>      backend_deployment_type          = optional(string, "REGIONAL_LAMBDA")<br>      timeout                          = optional(number, 25)<br>      memory_size                      = optional(number, 1536)<br>      additional_environment_variables = optional(map(string), {})<br>      function_architecture            = optional(string)<br>      additional_iam_policies = optional(list(object({<br>        name   = string,<br>        arn    = optional(string)<br>        policy = optional(string)<br>      })), [])<br>      vpc = optional(object({<br>        security_group_ids = list(string),<br>        subnet_ids         = list(string)<br>      }))<br>      iam = optional(object({<br>        path                 = optional(string)<br>        permissions_boundary = optional(string)<br>      }))<br>      cloudwatch_log = optional(object({<br>        retention_in_days = number<br>      }))<br>      timeouts = optional(object({<br>        create = optional(string)<br>        update = optional(string)<br>        delete = optional(string)<br>      }), {})<br>    }))<br>    revalidation_function = optional(object({<br>      function_code = optional(object({<br>        handler = optional(string, "index.handler")<br>        zip = optional(object({<br>          path = string<br>          hash = string<br>        }))<br>        s3 = optional(object({<br>          bucket         = string<br>          key            = string<br>          object_version = optional(string)<br>        }))<br>      }))<br>      runtime                          = optional(string, "nodejs20.x")<br>      timeout                          = optional(number, 25)<br>      memory_size                      = optional(number, 1536)<br>      additional_environment_variables = optional(map(string), {})<br>      function_architecture            = optional(string)<br>      additional_iam_policies = optional(list(object({<br>        name   = string,<br>        arn    = optional(string)<br>        policy = optional(string)<br>      })), [])<br>      vpc = optional(object({<br>        security_group_ids = list(string),<br>        subnet_ids         = list(string)<br>      }))<br>      iam = optional(object({<br>        path                 = optional(string)<br>        permissions_boundary = optional(string)<br>      }))<br>      cloudwatch_log = optional(object({<br>        retention_in_days = number<br>      }))<br>      timeouts = optional(object({<br>        create = optional(string)<br>        update = optional(string)<br>        delete = optional(string)<br>      }), {})<br>    }))<br>    tag_mapping_db = optional(object({<br>      deployment     = optional(string, "CREATE")<br>      billing_mode   = optional(string, "PAY_PER_REQUEST")<br>      read_capacity  = optional(number)<br>      write_capacity = optional(number)<br>      revalidate_gsi = optional(object({<br>        read_capacity  = optional(number)<br>        write_capacity = optional(number)<br>      }), {})<br>    }))<br>    website_bucket = optional(object({<br>      force_destroy = optional(bool, false)<br>      arn           = optional(string)<br>      region        = optional(string)<br>      name          = optional(string)<br>    }))<br>    distribution = optional(object({<br>      deployment   = optional(string, "CREATE")<br>      enabled      = optional(bool, true)<br>      ipv6_enabled = optional(bool, true)<br>      http_version = optional(string, "http2")<br>      price_class  = optional(string, "PriceClass_100")<br>      geo_restrictions = optional(object({<br>        type      = optional(string, "none"),<br>        locations = optional(list(string), [])<br>      }), {})<br>      x_forwarded_host_function = optional(object({<br>        runtime = optional(string)<br>        code    = optional(string)<br>      }), {})<br>      auth_function = optional(object({<br>        deployment    = optional(string, "NONE")<br>        qualified_arn = optional(string)<br>        function_code = optional(object({<br>          handler = optional(string, "index.handler")<br>          zip = optional(object({<br>            path = string<br>            hash = string<br>          }))<br>          s3 = optional(object({<br>            bucket         = string<br>            key            = string<br>            object_version = optional(string)<br>          }))<br>        }))<br>        runtime     = optional(string, "nodejs20.x")<br>        timeout     = optional(number, 10)<br>        memory_size = optional(number, 256)<br>        additional_iam_policies = optional(list(object({<br>          name   = string,<br>          arn    = optional(string)<br>          policy = optional(string)<br>        })), [])<br>        iam = optional(object({<br>          path                 = optional(string)<br>          permissions_boundary = optional(string)<br>        }))<br>        cloudwatch_log = optional(object({<br>          retention_in_days = number<br>        }))<br>        timeouts = optional(object({<br>          create = optional(string)<br>          update = optional(string)<br>          delete = optional(string)<br>        }), {})<br>      }), {})<br>      cache_policy = optional(object({<br>        deployment            = optional(string, "CREATE")<br>        arn                   = optional(string)<br>        default_ttl           = optional(number, 0)<br>        max_ttl               = optional(number, 31536000)<br>        min_ttl               = optional(number, 0)<br>        cookie_behavior       = optional(string, "all")<br>        header_behavior       = optional(string, "whitelist")<br>        header_items          = optional(list(string), ["accept", "rsc", "next-router-prefetch", "next-router-state-tree", "next-url"])<br>        query_string_behavior = optional(string, "all")<br>      }), {})<br>    }))<br>    behaviours = optional(object({<br>      custom_error_responses = optional(object({<br>        path_overrides = optional(map(object({<br>          allowed_methods          = optional(list(string))<br>          cached_methods           = optional(list(string))<br>          cache_policy_id          = optional(string)<br>          origin_request_policy_id = optional(string)<br>          compress                 = optional(bool)<br>          viewer_protocol_policy   = optional(string)<br>          viewer_request = optional(object({<br>            type         = string<br>            arn          = string<br>            include_body = optional(bool)<br>          }))<br>          viewer_response = optional(object({<br>            type = string<br>            arn  = string<br>          }))<br>          origin_request = optional(object({<br>            arn          = string<br>            include_body = bool<br>          }))<br>          origin_response = optional(object({<br>            arn = string<br>          }))<br>        })))<br>        allowed_methods          = optional(list(string))<br>        cached_methods           = optional(list(string))<br>        cache_policy_id          = optional(string)<br>        origin_request_policy_id = optional(string)<br>        compress                 = optional(bool)<br>        viewer_protocol_policy   = optional(string)<br>        viewer_request = optional(object({<br>          type         = string<br>          arn          = string<br>          include_body = optional(bool)<br>        }))<br>        viewer_response = optional(object({<br>          type = string<br>          arn  = string<br>        }))<br>        origin_request = optional(object({<br>          type         = string<br>          arn          = string<br>          include_body = optional(bool)<br>        }))<br>        origin_response = optional(object({<br>          type = string<br>          arn  = string<br>        }))<br>      }))<br>      static_assets = optional(object({<br>        paths            = optional(list(string))<br>        additional_paths = optional(list(string))<br>        path_overrides = optional(map(object({<br>          allowed_methods          = optional(list(string))<br>          cached_methods           = optional(list(string))<br>          cache_policy_id          = optional(string)<br>          origin_request_policy_id = optional(string)<br>          compress                 = optional(bool)<br>          viewer_protocol_policy   = optional(string)<br>          viewer_request = optional(object({<br>            type         = string<br>            arn          = string<br>            include_body = optional(bool)<br>          }))<br>          viewer_response = optional(object({<br>            type = string<br>            arn  = string<br>          }))<br>          origin_request = optional(object({<br>            arn          = string<br>            include_body = bool<br>          }))<br>          origin_response = optional(object({<br>            arn = string<br>          }))<br>        })))<br>        allowed_methods          = optional(list(string))<br>        cached_methods           = optional(list(string))<br>        cache_policy_id          = optional(string)<br>        origin_request_policy_id = optional(string)<br>        compress                 = optional(bool)<br>        viewer_protocol_policy   = optional(string)<br>        viewer_request = optional(object({<br>          type         = string<br>          arn          = string<br>          include_body = optional(bool)<br>        }))<br>        viewer_response = optional(object({<br>          type = string<br>          arn  = string<br>        }))<br>        origin_request = optional(object({<br>          type         = string<br>          arn          = string<br>          include_body = optional(bool)<br>        }))<br>        origin_response = optional(object({<br>          type = string<br>          arn  = string<br>        }))<br>      }))<br>      server = optional(object({<br>        paths = optional(list(string))<br>        path_overrides = map(object({<br>          allowed_methods          = optional(list(string))<br>          cached_methods           = optional(list(string))<br>          cache_policy_id          = optional(string)<br>          origin_request_policy_id = optional(string)<br>          compress                 = optional(bool)<br>          viewer_protocol_policy   = optional(string)<br>          viewer_request = optional(object({<br>            type         = string<br>            arn          = string<br>            include_body = optional(bool)<br>          }))<br>          viewer_response = optional(object({<br>            type = string<br>            arn  = string<br>          }))<br>          origin_request = optional(object({<br>            arn          = string<br>            include_body = bool<br>          }))<br>          origin_response = optional(object({<br>            arn = string<br>          }))<br>        }))<br>        allowed_methods          = optional(list(string))<br>        cached_methods           = optional(list(string))<br>        cache_policy_id          = optional(string)<br>        origin_request_policy_id = optional(string)<br>        compress                 = optional(bool)<br>        viewer_protocol_policy   = optional(string)<br>        viewer_request = optional(object({<br>          type         = string<br>          arn          = string<br>          include_body = optional(bool)<br>        }))<br>        viewer_response = optional(object({<br>          type = string<br>          arn  = string<br>        }))<br>        origin_request = optional(object({<br>          type         = string<br>          arn          = string<br>          include_body = optional(bool)<br>        }))<br>        origin_response = optional(object({<br>          type = string<br>          arn  = string<br>        }))<br>      }))<br>      image_optimisation = optional(object({<br>        paths = optional(list(string))<br>        path_overrides = map(object({<br>          allowed_methods          = optional(list(string))<br>          cached_methods           = optional(list(string))<br>          cache_policy_id          = optional(string)<br>          origin_request_policy_id = optional(string)<br>          compress                 = optional(bool)<br>          viewer_protocol_policy   = optional(string)<br>          viewer_request = optional(object({<br>            type         = string<br>            arn          = string<br>            include_body = optional(bool)<br>          }))<br>          viewer_response = optional(object({<br>            type = string<br>            arn  = string<br>          }))<br>          origin_request = optional(object({<br>            arn          = string<br>            include_body = bool<br>          }))<br>          origin_response = optional(object({<br>            arn = string<br>          }))<br>        }))<br>        allowed_methods          = optional(list(string))<br>        cached_methods           = optional(list(string))<br>        cache_policy_id          = optional(string)<br>        origin_request_policy_id = optional(string)<br>        compress                 = optional(bool)<br>        viewer_protocol_policy   = optional(string)<br>        viewer_request = optional(object({<br>          type         = string<br>          arn          = string<br>          include_body = optional(bool)<br>        }))<br>        viewer_response = optional(object({<br>          type = string<br>          arn  = string<br>        }))<br>        origin_request = optional(object({<br>          type         = string<br>          arn          = string<br>          include_body = optional(bool)<br>        }))<br>        origin_response = optional(object({<br>          type = string<br>          arn  = string<br>        }))<br>      }))<br>    }))<br>    waf = optional(object({<br>      deployment = optional(string, "NONE")<br>      web_acl_id = optional(string)<br>      aws_managed_rules = optional(list(object({<br>        priority              = optional(number)<br>        name                  = string<br>        aws_managed_rule_name = string<br>        })), [{<br>        name                  = "amazon-ip-reputation-list"<br>        aws_managed_rule_name = "AWSManagedRulesAmazonIpReputationList"<br>        }, {<br>        name                  = "common-rule-set"<br>        aws_managed_rule_name = "AWSManagedRulesCommonRuleSet"<br>        }, {<br>        name                  = "known-bad-inputs"<br>        aws_managed_rule_name = "AWSManagedRulesKnownBadInputsRuleSet"<br>      }])<br>      rate_limiting = optional(object({<br>        enabled = optional(bool, false)<br>        limits = optional(list(object({<br>          priority         = optional(number)<br>          rule_name_suffix = optional(string)<br>          limit            = optional(number, 1000)<br>          action           = optional(string, "BLOCK")<br>          geo_match_scope  = optional(list(string))<br>        })), [])<br>      }), {})<br>      sqli = optional(object({<br>        enabled  = optional(bool, false)<br>        priority = optional(number)<br>      }), {})<br>      account_takeover_protection = optional(object({<br>        enabled              = optional(bool, false)<br>        priority             = optional(number)<br>        login_path           = string<br>        enable_regex_in_path = optional(bool)<br>        request_inspection = optional(object({<br>          username_field_identifier = string<br>          password_field_identifier = string<br>          payload_type              = string<br>        }))<br>        response_inspection = optional(object({<br>          failure_codes = list(string)<br>          success_codes = list(string)<br>        }))<br>      }))<br>      account_creation_fraud_prevention = optional(object({<br>        enabled                = optional(bool, false)<br>        priority               = optional(number)<br>        creation_path          = string<br>        registration_page_path = string<br>        enable_regex_in_path   = optional(bool)<br>        request_inspection = optional(object({<br>          email_field_identifier    = string<br>          username_field_identifier = string<br>          password_field_identifier = string<br>          payload_type              = string<br>        }))<br>        response_inspection = optional(object({<br>          failure_codes = list(string)<br>          success_codes = list(string)<br>        }))<br>      }))<br>      enforce_basic_auth = optional(object({<br>        enabled       = optional(bool, false)<br>        priority      = optional(number)<br>        response_code = optional(number, 401)<br>        response_header = optional(object({<br>          name  = optional(string, "WWW-Authenticate")<br>          value = optional(string, "Basic realm=\"Requires basic auth\"")<br>        }), {})<br>        header_name = optional(string, "authorization")<br>        credentials = optional(object({<br>          username          = string<br>          password          = string<br>          mark_as_sensitive = optional(bool, true)<br>        }))<br>        ip_address_restrictions = optional(list(object({<br>          action = optional(string, "BYPASS")<br>          arn    = optional(string)<br>          name   = optional(string)<br>        })))<br>      }))<br>      additional_rules = optional(list(object({<br>        enabled  = optional(bool, false)<br>        priority = optional(number)<br>        name     = string<br>        action   = optional(string, "COUNT")<br>        block_action = optional(object({<br>          response_code = number<br>          response_header = optional(object({<br>            name  = string<br>            value = string<br>          }))<br>          custom_response_body_key = optional(string)<br>        }))<br>        ip_address_restrictions = list(object({<br>          action = optional(string, "BYPASS")<br>          arn    = optional(string)<br>          name   = optional(string)<br>        }))<br>      })))<br>      default_action = optional(object({<br>        action = optional(string, "ALLOW")<br>        block_action = optional(object({<br>          response_code = number<br>          response_header = optional(object({<br>            name  = string<br>            value = string<br>          }))<br>          custom_response_body_key = optional(string)<br>        }))<br>      }))<br>      ip_addresses = optional(map(object({<br>        description        = optional(string)<br>        ip_address_version = string<br>        addresses          = list(string)<br>      })))<br>      custom_response_bodies = optional(list(object({<br>        key          = string<br>        content      = string<br>        content_type = string<br>      })))<br>    }))<br>    domain_config = optional(object({<br>      evaluate_target_health = optional(bool, true)<br>      sub_domain             = optional(string)<br>      hosted_zones = list(object({<br>        name         = string<br>        id           = optional(string)<br>        private_zone = optional(bool, false)<br>      }))<br>      create_route53_entries = optional(bool, true)<br>      viewer_certificate = optional(object({<br>        acm_certificate_arn      = string<br>        ssl_support_method       = optional(string, "sni-only")<br>        minimum_protocol_version = optional(string, "TLSv1.2_2021")<br>      }))<br>    }))<br>    continuous_deployment = optional(object({<br>      use        = optional(bool, false)<br>      deployment = optional(string, "NONE")<br>      traffic_config = optional(object({<br>        header = optional(object({<br>          name  = string<br>          value = string<br>        }))<br>        weight = optional(object({<br>          percentage = number<br>          session_stickiness = optional(object({<br>            idle_ttl    = number<br>            maximum_ttl = number<br>          }))<br>        }))<br>      }))<br>    }))<br>    custom_error_responses = optional(list(object({<br>      error_code            = string<br>      error_caching_min_ttl = optional(number)<br>      response_code         = optional(string)<br>      response_page = optional(object({<br>        source      = string<br>        path_prefix = string<br>      }))<br>    })))<br>  }))</pre> | n/a | yes |

### Outputs

| Name | Description |
|------|-------------|
| <a name="output_alternate_domain_names"></a> [alternate\_domain\_names](#output\_alternate\_domain\_names) | Extra CNAMEs (alternate domain names) associated with the cloudfront distribution |
| <a name="output_cloudfront_distribution_id"></a> [cloudfront\_distribution\_id](#output\_cloudfront\_distribution\_id) | The ID for the root cloudfront distribution |
| <a name="output_cloudfront_staging_distribution_id"></a> [cloudfront\_staging\_distribution\_id](#output\_cloudfront\_staging\_distribution\_id) | The ID for the root cloudfront staging distribution |
| <a name="output_cloudfront_url"></a> [cloudfront\_url](#output\_cloudfront\_url) | The URL for the root cloudfront distribution |
| <a name="output_zones"></a> [zones](#output\_zones) | Configuration details of the zones |
