# Certificates and Domain

*NOTE:* If you do not need a custom domain, please ignore this documentation. The autogenerated CloudFront distribution URL can be used instead.

Due to the variety of DNS providers and approaches to configuring DNS records, the module has been designed to handle many scenarios.

By default, the module assumes you want to create and manage custom domains (including www subdomains, custom subdomains, etc.) using Route53. The sections below outline examples of changing the default configuration for managing custom domains.

At the time of writing, the module does not support creating and validating ACM certificates. Therefore, you must supply the ARN of an ACM certificate (hosted in us-east-1) to attach to the CloudFront distribution. The example below shows the minimum configuration to provide the ACM certificate ARN.

```tf
domain_config = {
  hosted_zones = [{
    name = "test.co.uk"
  }]
  viewer_certificate = {
    acm_certificate_arn = "<<acm_certificate arn>"
  }
}
```

If `ipv6_enabled` is enabled (default of true), then A and AAAA records will be created in Route53. If false, only A record(s) will be created.

## Disabling the creation of Route 53 records

*NOTE:* By default, the module will create route53 records

Under specific scenarios, you may want a custom domain to be associated with your single or multi-zone application; however, you do not want the Terraform module to manage the creation of Route53 records. Therefore, you can specify the following configuration to turn off the creation of the records.

```tf
domain_config = {
  create_route53_entries = false
  hosted_zones = [{
    name = "test.co.uk"
  }]
  viewer_certificate = {
    acm_certificate_arn = "<<acm_certificate arn>"
  }
}
```

## Including the www subdomain

*NOTE:* By default, this is disabled

You may want a custom subdomain and include the `www` subdomain. Therefore, you can specify the following configuration to create Route53 records and CloudFront distribution aliases for `www.website.test.co.uk` and `website.test.co.uk`

```tf
domain_config = {
  include_www = true
  sub_domain = "website"
  hosted_zones = [{
    name = "test.co.uk"
  }]
  viewer_certificate = {
    acm_certificate_arn = "<<acm_certificate arn>"
  }
}
```

The subdomain argument can be omitted if you do not need a subdomain. Therefore, you can specify the following configuration to create Route53 records and CloudFront distribution aliases for `www.test.co.uk` and `test.co.uk`

```tf
domain_config = {
  include_www = true
  hosted_zones = [{
    name = "test.co.uk"
  }]
  viewer_certificate = {
    acm_certificate_arn = "<<acm_certificate arn>"
  }
}
```

## Specifying a subdomain

You may want to create a subdomain for your website. Therefore, you can specify the following configuration to create Route53 records and CloudFront distribution aliases for `website.test.co.uk`

```tf
domain_config = {
  sub_domain = "website"
  hosted_zones = [{
    name = "test.co.uk"
  }]
  viewer_certificate = {
    acm_certificate_arn = "<<acm_certificate arn>"
  }
}
```

## Using hosted zone name, i.e. no subdomain

For a given single or multi-zone application, you may want to avoid creating a subdomain for your website. Therefore, you can specify the following configuration to create Route53 records and CloudFront distribution aliases for `test.co.uk`

```tf
domain_config = {
  hosted_zones = [{
    name = "test.co.uk"
  }]
  viewer_certificate = {
    acm_certificate_arn = "<<acm_certificate arn>"
  }
}
```

## Overwriting Route53 records

*NOTE:* By default, this is disabled

If a record already exists in Route53 that you want to use for your single or multi-zone application, you may see the following error. 

```sh
creating Route 53 Record: InvalidChangeBatch: [Tried to create resource record set [name='test.com.', type='A'] but it already exists]
```

You can import the resource into the Terraform state file or use the `route53_record_allow_overwrite` argument of the `domain_config` variable to force Route53 to overwrite the existing records. An example terraform configuration can be seen below.

```tf
domain_config = {
  route53_record_allow_overwrite = true
  hosted_zones = [{
    name = "test.co.uk"
  }]
  viewer_certificate = {
    acm_certificate_arn = "<<acm_certificate arn>"
  }
}
```

*NOTE:* Although this is possible, the Terraform docs do not recommend this for most environments

## Configuring public and private hosted zones

For each zone you can specify if the zone is a public hosted zone (default/ false) or a private hosted zone (true). The example terraform configuration below shows how to configure DNS records for both the public and private hosted zone for `test.co.uk`

```tf
domain_config = {
  route53_record_allow_overwrite = true
  hosted_zones = [{
    name = "test.co.uk"
  },{
    name = "test.co.uk"
    private_zone = false
  }]
  viewer_certificate = {
    acm_certificate_arn = "<<acm_certificate arn>"
  }
}
```

*NOTE:* The module does not currently support having different subdomains for each hosted zone.